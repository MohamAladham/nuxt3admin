<script setup lang="ts">import {USER_DEFAULT_AVATAR} from "@/constants";import {queryBuilder, pushDataToRouter} from "~/composables/useUrlHelper";import {useUsersStore} from "~/stores/users";const route = useRoute();const config = useRuntimeConfig();const showFilterModal = ref(false);const filter = reactive({  search: route.query.search || null,  page: route.query.page || null,  name: route.query.name || null,  email: route.query.email || null,})const submitFilter = () => {  showFilterModal.value = false;  refreshItems()}let urlQueryStr = ref(queryBuilder(filter));const {data: items, pending, refresh: reFetch, error} =    await useFetch(() => config.public.apiBase + '/users' + urlQueryStr.value);useUsersStore().items = items;const refreshItems = () => {  pushDataToRouter(filter);  //urlQueryStr is reactive, so the useFetch will fire again  urlQueryStr.value = queryBuilder(filter);}const itemURL = `/admin/users/`;definePageMeta({  layout: "admin",});</script><template>  <div>    <AdminItemsPage :filter="filter" @refreshItems="refreshItems" :items="items">      <template #buttons>        <AdminUIButton to="/admin/users/create" icon="bi bi-plus">          Add New        </AdminUIButton>        <AdminUIButton color="warning" icon="bi bi-funnel" @click="showFilterModal = true">          Filter        </AdminUIButton>        <AdminUIButton color="secondary" icon="bi bi-box-arrow-right">          Export        </AdminUIButton>      </template>      <template #table>        <AdminUITable v-if="items" :titles="[{text:'User Name'}, {text:'Email'}, {text:'Manage', colWidth:2}]">          <AdminUITableRow v-for="item in items.data">            <AdminUITableCol textAlign="left">              <NuxtLink :href="itemURL+item.id">                <img :src="item.photo?item.photo:USER_DEFAULT_AVATAR" class="rounded-circle" style="width:40px; height: 40px; margin-left: 3px"/>                {{ item.name }}              </NuxtLink>            </AdminUITableCol>            <AdminUITableCol>              {{ item.email }}            </AdminUITableCol>            <AdminUITableCol :colWidth="2">              <AdminUIButton color="secondary" :to="itemURL+item.id">                Edit              </AdminUIButton>              <AdminUIButton color="danger">                Delete              </AdminUIButton>            </AdminUITableCol>          </AdminUITableRow>        </AdminUITable>      </template>    </AdminItemsPage>    <AdminUIModal v-model:showModal="showFilterModal" id="filterModal" title="Filter" primaryBtnText="Filter" @primaryBtnClicked="submitFilter">      <AdminUIInput id="search" label="Search for"                    v-model="filter.search"                    :colWidth="12"/>      <AdminUIInput id="name" label="User Name"                    v-model="filter.name"                    :colWidth="12"/>      <AdminUIInput id="email" label="User Email"                    v-model="filter.email"                    :colWidth="12"/>    </AdminUIModal>  </div></template>